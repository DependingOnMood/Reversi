angular.module("myApp",[]).factory("gameLogic",function(){"use strict";function a(a,b){return angular.equals(a,b)}function b(a){return angular.copy(a)}function c(a){return""===a.board[a.row][a.col]?!0:!1}function d(a,b,c,d,e){return b>0&&a[b-1][c]===e&&d.push("V1"),7>b&&a[b+1][c]===e&&d.push("V2"),c>0&&a[b][c-1]===e&&d.push("H1"),7>c&&a[b][c+1]===e&&d.push("H2"),b>0&&c>0&&a[b-1][c-1]===e&&d.push("D1"),b>0&&7>c&&a[b-1][c+1]===e&&d.push("D2"),7>b&&7>c&&a[b+1][c+1]===e&&d.push("D3"),7>b&&c>0&&a[b+1][c-1]===e&&d.push("D4"),d.length?!0:!1}function e(a,c,d,e,f,g){for(var h=0,i=b(a),j=0;j<e.length;j++)switch(e[j]){case"V1":for(var k=-1,l=1,m=c-1;m>=0;m--)if(a[m][d]===f){k=m;break}if(-1===k)break;for(var m=c-1;m>k;m--)if(a[m][d]!==g){l=0;break}if(l){for(var m=c-1;m>k;m--)i[m][d]=f;i[c][d]=f,h++}break;case"V2":for(var k=-1,l=1,m=c+1;o>=m;m++)if(a[m][d]===f){k=m;break}if(-1===k)break;for(var m=c+1;k>m;m++)if(a[m][d]!==g){l=0;break}if(l){for(var m=c+1;k>m;m++)i[m][d]=f;i[c][d]=f,h++}break;case"H1":for(var k=-1,l=1,m=d-1;m>=0;m--)if(a[c][m]===f){k=m;break}if(-1===k)break;for(var m=d-1;m>k;m--)if(a[c][m]!==g){l=0;break}if(l){for(var m=d-1;m>k;m--)i[c][m]=f;i[c][d]=f,h++}break;case"H2":for(var k=-1,l=1,m=d+1;p>=m;m++)if(a[c][m]===f){k=m;break}if(-1===k)break;for(var m=d+1;k>m;m++)if(a[c][m]!==g){l=0;break}if(l){for(var m=d+1;k>m;m++)i[c][m]=f;i[c][d]=f,h++}break;case"D1":for(var n=-1,q=-1,l=1,m=c-1,r=d-1;m>=0&&r>=0;m--,r--)if(a[m][r]===f){n=m,q=r;break}if(-1===n)break;for(var m=c-1,r=d-1;m>n&&r>q;m--,r--)if(a[m][r]!==g){l=0;break}if(l){for(var m=c-1,r=d-1;m>n&&r>q;m--,r--)i[m][r]=f;i[c][d]=f,h++}break;case"D2":for(var n=-1,q=-1,l=1,m=c-1,r=d+1;m>=0&&p>=r;m--,r++)if(a[m][r]===f){n=m,q=r;break}if(-1===n)break;for(var m=c-1,r=d+1;m>n&&q>r;m--,r++)if(a[m][r]!==g){l=0;break}if(l){for(var m=c-1,r=d+1;m>n&&q>r;m--,r++)i[m][r]=f;i[c][d]=f,h++}break;case"D3":for(var n=-1,q=-1,l=1,m=c+1,r=d+1;o>=m&&p>=r;m++,r++)if(a[m][r]===f){n=m,q=r;break}if(-1===n)break;for(var m=c+1,r=d+1;n>m&&q>r;m++,r++)if(a[m][r]!==g){l=0;break}if(l){for(var m=c+1,r=d+1;n>m&&q>r;m++,r++)i[m][r]=f;i[c][d]=f,h++}break;case"D4":for(var n=-1,q=-1,l=1,m=c+1,r=d-1;o>=m&&r>=0;m++,r--)if(a[m][r]===f){n=m,q=r;break}if(-1===n)break;for(var m=c+1,r=d-1;n>m&&r>q;m++,r--)if(a[m][r]!==g){l=0;break}if(l){for(var m=c+1,r=d-1;n>m&&r>q;m++,r--)i[m][r]=f;i[c][d]=f,h++}}return h?{count:h,tempBoard:i,status:!0}:{count:h,status:!1}}function f(a,f,i,j){if(void 0===a&&(a=[["","","","","","","",""],["","","","","","","",""],["","","","","","","",""],["","","","W","B","","",""],["","","","B","W","","",""],["","","","","","","",""],["","","","","","","",""],["","","","","","","",""]]),!c({board:a,row:f,col:i}))throw new Error("One can only make a move in an empty position!");var k=0===j?"W":"B",l=[];if(!d(a,f,i,l,k))throw new Error("One can only make a move next to the opponent's piece!");var m=0===j?"B":"W",n=e(a,f,i,l,m,k);if(!n.status)throw new Error("One must sandwich opponent's pieces on every move!");var o,p=b(a);p[f][i]=0===j?"B":"W";var q=h(n.tempBoard);if(q.status)o={endMatch:{endMatchScores:"B"===q.winner?[1,0]:"W"===q.winner?[0,1]:[0,0]}};else{var r=0==j?"W":"B",s=0==j?"B":"W",t=g(r,s,n.tempBoard);o=t?{setTurn:{turnIndex:1-j}}:{setTurn:{turnIndex:j}}}return[o,{set:{key:"board",value:n.tempBoard}},{set:{key:"delta",value:{row:f,col:i}}}]}function g(a,b,f){for(var g=0,h=0;o>=h;h++){for(var i=0;p>=i;i++)if(c({board:f,row:h,col:i})){var j=[];if(d(f,h,i,j,b)){var k=e(f,h,i,j,a,b);if(k.status&&k.count){g=1;break}}}if(g)break}return g?!0:!1}function h(a){for(var b,c=0,d=0;o>=d;d++)for(var e=0;p>=e;e++)""===a[d][e]&&c++;return c&&(g("W","B",a)||g("B","W",a))?{status:!1}:(b=i(a),{winner:b,status:!0})}function i(a){for(var b=0,c=0,d=0;o>=d;d++)for(var e=0;p>=e;e++)"W"===a[d][e]?b++:"B"===a[d][e]&&c++;return b>c?"W":c>b?"B":"T"}function j(b){var c=b.turnIndexBeforeMove,d=b.stateBeforeMove,e=d.board,g=b.move;try{var h=g[2].set.value.row,i=g[2].set.value.col,j=f(e,h,i,c);if(!a(g,j))return!1}catch(k){return!1}return!0}function k(a,b,c){for(var d,e=b,g=[],h=a,i=0;i<c.length;i++){var j=c[i];d=f(e.board,j.row,j.col,h);var k={board:d[1].set.value,delta:d[2].set.value};g.push({stateBeforeMove:e,stateAfterMove:k,turnIndexBeforeMove:h,turnIndexAfterMove:d[0].setTurn.turnIndex,comment:{en:j.comment},move:d}),h=d[0].setTurn.turnIndex,e=k}return g}function l(){return k(0,{board:[["","","B","W","W","W","",""],["","","B","B","W","W","",""],["W","W","B","W","W","W","B","B"],["W","B","W","W","B","W","B","B"],["W","W","B","W","B","B","B","B"],["W","W","W","B","W","B","W","W"],["","","W","W","B","B","",""],["","","W","B","B","B","",""]],delta:{row:2,col:0}},[{row:0,col:6,comment:"Black plays on square (0,6)"},{row:0,col:1,comment:"White plays on square (0,1)"},{row:7,col:1,comment:"Black plays row 7, col 1"},{row:6,col:6,comment:"Uh oh, white plays in x-Square"},{row:7,col:7,comment:"Black captures bottom-left corner!"},{row:6,col:7,comment:"White plays (6,7)"}])}function m(){return[k(1,{board:[["","","B","W","W","W","B",""],["","B","B","B","W","W","W",""],["W","W","B","W","W","W","B","B"],["W","B","W","W","B","W","B","B"],["W","W","B","W","B","B","B","B"],["W","W","W","B","W","B","W","W"],["","","W","W","B","B","",""],["","","W","B","B","B","",""]],delta:{row:2,col:0}},[{row:0,col:0,comment:"Where should White play to get an advantage on his next turn?"},{row:6,col:6,comment:"Black plays row 6, col 6"},{row:7,col:7,comment:"White captures diagonal!"}]),k(0,{board:[["","B","B","B","B","B","B",""],["","","B","B","W","W","",""],["W","W","B","W","W","W","B","B"],["W","B","W","W","B","W","B","B"],["W","W","B","W","B","B","B","B"],["W","W","W","B","W","B","W","W"],["","","W","W","B","B","",""],["","","B","B","B","B","B",""]],delta:{row:3,col:0}},[{row:7,col:1,comment:"Where should Black play to not give White an advantage on his next turn?"},{row:1,col:7,comment:"White in (1,7)"}])]}function n(a,b){var c,d,e=[];for(c=0;8>c;c++)for(d=0;8>d;d++)try{e.push(f(a,c,d,b))}catch(g){}var h=e[Math.floor(Math.random()*e.length)];return h}var o=7,p=7;return{createMove:f,isMoveOk:j,exampleGame:l,riddles:m,createComputerMove:n}}),angular.module("myApp").controller("Ctrl",["$scope","$log","$timeout","gameService","gameLogic","resizeGameAreaService",function(a,b,c,d,e,f){"use strict";function g(a,b,c){var d=b-t.offsetLeft,e=c-t.offsetTop;if(0>d||0>e||d>=t.clientWidth||e>=t.clientHeight)return s.style.display="none",void(p.style.display="none");var f=Math.floor(v*d/t.clientWidth),g=Math.floor(u*e/t.clientHeight);m(g,f)?(s.style.display="inline",p.style.display="inline",q.style.stroke="green",r.style.stroke="green"):(s.style.display="none",p.style.display="inline",q.style.stroke="red",r.style.stroke="red");var h=j(g,f);r.setAttribute("x1",h.x),r.setAttribute("x2",h.x),q.setAttribute("y1",h.y),q.setAttribute("y2",h.y);var l=i(g,f);s.style.left=l.left+"px",s.style.top=l.top+"px",("touchend"===a||"touchcancel"===a||"touchleave"===a||"mouseup"===a)&&(s.style.display="none",p.style.display="none",k(g,f))}function h(){return{width:t.clientWidth/v,height:t.clientHeight/u}}function i(a,b){var c=h();return{top:a*c.height,left:b*c.width}}function j(a,b){var c=h();return{x:b*c.width+c.width/2,y:a*c.height+c.height/2}}function k(c,f){if(a.isYourTurn)try{var g=e.createMove(a.board,c,f,a.turnIndex);a.isYourTurn=!1,d.makeMove(g)}catch(h){return void b.info(["wrong move",c,f])}}function l(a){for(var b=[],c=0;a>c;c++)b.push(c);return b}function m(b,c){try{return e.createMove(a.board,b,c,a.turnIndex),!0}catch(d){return!1}}function n(){d.makeMove(e.createComputerMove(a.board,a.turnIndex))}function o(b){a.board=b.stateAfterMove.board,a.delta=b.stateAfterMove.delta,void 0===a.board&&(a.board=[["","","","","","","",""],["","","","","","","",""],["","","","","","","",""],["","","","W","B","","",""],["","","","B","W","","",""],["","","","","","","",""],["","","","","","","",""],["","","","","","","",""]]),a.isYourTurn=b.turnIndexAfterMove>=0&&b.yourPlayerIndex===b.turnIndexAfterMove,a.turnIndex=b.turnIndexAfterMove,a.isYourTurn&&""===b.playersInfo[b.yourPlayerIndex].playerId&&(a.isYourTurn=!1,c(n,1e3))}var p=document.getElementById("draggingLines"),q=document.getElementById("horizontalDraggingLine"),r=document.getElementById("verticalDraggingLine"),s=document.getElementById("clickToDragPiece"),t=document.getElementById("gameArea"),u=8,v=8;window.handleDragEvent=g,f.setWidthToHeight(1),a.rows=l(u),a.cols=l(v),a.rowsNum=u,a.colsNum=v,o({stateAfterMove:{},turnIndexAfterMove:0,yourPlayerIndex:-2}),a.getPreviewSrc=function(){return 1===a.turnIndex?"res/pieceWhite.png":"res/pieceBlack.png"},a.shouldSlowlyAppear=function(b,c){return void 0!==a.delta&&a.delta.row===b&&a.delta.col===c},a.isWhite=function(b,c){return"W"===a.board[b][c]?!0:!1},a.isBlack=function(b,c){return"B"===a.board[b][c]?!0:!1},a.oddSum=function(a,b){return(a+b)%2!==0?!0:!1},a.evenSum=function(a,b){return(a+b)%2===0?!0:!1},d.setGame({gameDeveloperEmail:"xiaodongbo627@gmail.com",minNumberOfPlayers:2,maxNumberOfPlayers:2,exampleGame:e.exampleGame(),riddles:e.riddles(),isMoveOk:e.isMoveOk,updateUI:o})}]);
//# sourceMappingURL=everything.min.js.map